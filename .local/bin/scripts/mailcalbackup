#!/bin/bash
set -e

# Snapshot mail, calendars and contacts
# GPLv3 - Grim Kriegor <grimkriegor@krutt.org>
# 2018

date=$(date +"%Y%m%d")
archive_name="mailcal_$date"

tar cf \
  $archive_name.tar.xz \
  $HOME/.mail \
  $HOME/.calendars \
  $HOME/.contacts

gpg \
  --batch \
  --encrypt \
  --default-recipient-self \
  --output "$archive_name.tar.xz.gpg" \
  "$archive_name.tar.xz" \

checksum=$(md5sum \
  "$archive_name.tar.xz.gpg" \
  | awk '{print $1}')

mv \
  "$archive_name.tar.xz.gpg" \
  "${archive_name}_$checksum.tar.xz.gpg"

rm "$archive_name.tar.xz"
